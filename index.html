<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>BONA BEETLE | PGK Formosa Apex å»ºè­°ç³»çµ±</title>
    
    <!-- æ ¸å¿ƒè³‡æºè¼‰å…¥ -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;700;900&display=swap');
        
        :root {
            --bona-gold: #CA8A04;
            --bona-black: #050505;
            --bona-zinc: #18181B;
        }

        body { 
            font-family: 'Noto Sans TC', sans-serif; 
            background-color: var(--bona-black); 
            margin: 0; 
            color: #E2E8F0;
            overflow-x: hidden;
        }

        .bg-grid {
            position: fixed; inset: 0; z-index: -1;
            background-size: 32px 32px;
            background-image: linear-gradient(to right, rgba(202, 138, 4, 0.05) 1px, transparent 1px),
                              linear-gradient(to bottom, rgba(202, 138, 4, 0.05) 1px, transparent 1px);
        }

        /* ============================================================
           ğŸš€ ã€V6.30 çµ‚æ¥µåˆ—å°é¡¯å½±ä¿®å¾©ã€‘
           ============================================================ */
        
        /* ç¶²é ç‰ˆéš±è—åˆ—å°å…§å®¹ */
        .print-only-cert { display: none; }

        @media print {
            /* 1. è¨­å®š A4 */
            @page { size: A4; margin: 0; }
            
            /* 2. é‡ç½®èƒŒæ™¯èˆ‡é¡è‰² */
            html, body { 
                background: white !important; 
                background-color: white !important;
                color: black !important;
                margin: 0 !important;
                padding: 0 !important;
                height: auto !important;
                overflow: visible !important;
            }

            /* 3. éš±è—ç¶²é ç‰ˆå…§å®¹ï¼Œä½†ä¿ç•™ DOM */
            #web-view-ui, .no-print, .bg-grid { 
                display: none !important; 
                height: 0 !important;
                overflow: hidden !important;
            }

            /* 4. é¡¯ç¤ºåˆ—å°å°ˆç”¨æ²™ç›’ */
            .print-only-cert { 
                display: block !important; 
                background: white !important;
                color: black !important;
                padding: 40px !important;
                width: 100% !important;
                box-sizing: border-box;
                min-height: 100vh;
                position: relative !important;
            }

            /* 5. å¼·åˆ¶æ–‡å­—é¡è‰² */
            .print-only-cert h1, .print-only-cert h2, .print-only-cert p, 
            .print-only-cert span, .print-only-cert div {
                color: black !important;
                opacity: 1 !important;
                text-shadow: none !important;
            }

            .cert-border { 
                border: 4px solid #CA8A04 !important; 
                padding: 40px !important;
                border-radius: 4px !important;
            }

            .cert-gold-text { color: #CA8A04 !important; }
            .cert-bg-gray { background-color: #f9f9f9 !important; }

            /* 6. å¼·åˆ¶æ¸²æŸ“ï¼ˆé—œéµï¼ï¼‰ */
            * { -webkit-print-color-adjust: exact !important; print-color-adjust: exact !important; }
        }

        .animate-fade-up { animation: fadeUp 0.6s ease-out forwards; }
        @keyframes fadeUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

        input {
            background: rgba(24, 24, 27, 0.7);
            border: 1px solid rgba(255, 255, 255, 0.1);
            color: white;
            padding: 1rem;
            border-radius: 1rem;
            outline: none;
            transition: all 0.3s;
        }
        input:focus { border-color: #CA8A04; box-shadow: 0 0 15px rgba(202, 138, 4, 0.2); }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // --- å…¨åŸŸé…ç½® ---
        const BRAND_NAME = "BONA BEETLE";
        const MAKE_WEBHOOK_URL = "https://hook.us2.make.com/6whq8i6ov4nzs7qdya3diycuq6txy6wn"; 
        const LOGO_FILENAME = "logo.png"; 
        const EFF_CONSTANT = 3.48;

        const App = () => {
            const [view, setView] = useState('input'); // input, loading, report
            const [activeTab, setActiveTab] = useState('summary');
            const [showModal, setShowModal] = useState(false);
            const [isSending, setIsSending] = useState(false);
            const [contact, setContact] = useState('');
            const [logoError, setLogoError] = useState(false);
            const [formData, setFormData] = useState({ id: '', w: '', hatch: '', check: new Date().toISOString().split('T')[0], sub: 'æœ¨å±‘' });
            const [report, setReport] = useState(null);

            const handleAnalyze = (e) => {
                e.preventDefault();
                setView('loading');
                const w = parseFloat(formData.w);
                const days = Math.max(1, Math.floor((new Date(formData.check) - new Date(formData.hatch)) / (1000 * 60 * 60 * 24)));
                
                let status = "å„ªè‰¯ (Elite)";
                let advice = "æˆé•·æ–œç‡é©šäººï¼Œå€‹é«”æ­£è™•æ–¼ç©©å®šçš„ç†ŸåŒ–æœŸã€‚å»ºè­°é–å®šæº«æ§ç¯€å¥ï¼Œä»¥æœ€å¤§åŒ–å¤§é¡è§’è³ªå¯†åº¦ã€‚";
                if (w < 45) {
                    status = "ç™¼è‚²åç·©";
                    advice = "åµæ¸¬åˆ°è½‰æ›æ•ˆç‡åä½ã€‚ç›®å‰å€‹é«”ä½é»ç¨ä½æ–¼é»ƒé‡‘åŸºæº–ç·šï¼Œå»ºè­°é©åº¦æ·»åŠ ã€Œç™»å¤§èŸ²ã€å„ªåŒ–ã€‚";
                }

                setTimeout(() => {
                    setReport({ ...formData, weight: w, days, potential: (w * 2.15).toFixed(1), status, advice });
                    setView('report');
                }, 1000);
            };

            const submitLeadAndPrint = async (e) => {
                e.preventDefault();
                setIsSending(true);
                if (MAKE_WEBHOOK_URL) {
                    try {
                        await fetch(MAKE_WEBHOOK_URL, {
                            method: "POST",
                            headers: { "Content-Type": "application/json" },
                            body: JSON.stringify({ 
                                contact, 
                                id: report.id, 
                                weight: report.weight, 
                                timestamp: new Date().toISOString() 
                            })
                        });
                    } catch (err) { console.error(err); }
                }
                setIsSending(false);
                setShowModal(false);
                // ç¢ºä¿ç‹€æ…‹æ›´æ–°å¾Œå†è§¸ç™¼åˆ—å°
                setTimeout(() => window.print(), 800);
            };

            const LogoIcon = ({ className }) => {
                if (!logoError) {
                    return (
                        <img 
                            src={LOGO_FILENAME} 
                            className={className} 
                            onError={() => setLogoError(true)} 
                            alt="Logo"
                        />
                    );
                }
                // å¦‚æœ logo.png å¤±æ•—ï¼Œé¡¯ç¤ºç²¾ç¾çš„å…§å»º SVG
                return (
                    <div className={`${className} bg-[#CA8A04] rounded-xl flex items-center justify-center shadow-lg border border-yellow-500/50`}>
                        <svg viewBox="0 0 24 24" className="w-2/3 h-2/3 fill-black">
                            <path d="M12 2L4.5 20.29L5.21 21L12 18L18.79 21L19.5 20.29L12 2Z" />
                        </svg>
                    </div>
                );
            };

            const getX = (d) => (d / 650) * 100; 
            const getY = (w) => 100 - (w / 65) * 100;

            if (view === 'input') return (
                <div className="min-h-screen flex items-center justify-center p-6 text-left relative">
                    <div className="bg-grid"></div>
                    <div className="w-full max-w-md bg-[#18181B] border border-white/5 p-10 rounded-[2.5rem] shadow-2xl animate-fade-up">
                        <header className="text-center mb-10">
                            <LogoIcon className="w-20 h-20 mx-auto mb-6 p-0.5 bg-black rounded-xl border border-[#CA8A04]" />
                            <h1 className="text-3xl font-black text-white uppercase italic tracking-tighter" style={{ textShadow: '0 0 12px rgba(202, 138, 4, 0.4)' }}>
                                BONA <span className="text-[#CA8A04]">BEETLE</span>
                            </h1>
                            <p className="text-[10px] text-gray-500 uppercase font-bold tracking-widest mt-1">PGK Formosa Apex å»ºè­°ç³»çµ±</p>
                        </header>
                        <form onSubmit={handleAnalyze} className="space-y-6 flex flex-col text-left">
                            <input required placeholder="å€‹é«”è­˜åˆ¥æ¨™ç±¤ (å¦‚: PGK-01)" value={formData.id} onChange={e=>setFormData({...formData, id: e.target.value})} className="w-full" />
                            <div className="grid grid-cols-2 gap-4">
                                <div className="space-y-1">
                                    <label className="text-[9px] text-gray-500 font-bold uppercase ml-1">æŒ–å‡ºæ—¥æœŸ</label>
                                    <input type="date" required value={formData.hatch} onChange={e=>setFormData({...formData, hatch: e.target.value})} className="text-xs w-full" />
                                </div>
                                <div className="space-y-1">
                                    <label className="text-[9px] text-gray-500 font-bold uppercase ml-1">ä»Šæ—¥æ—¥æœŸ</label>
                                    <input type="date" required value={formData.check} onChange={e=>setFormData({...formData, check: e.target.value})} className="text-xs w-full" />
                                </div>
                            </div>
                            <input type="number" step="0.1" required placeholder="ç›®å‰é‡é‡ (g)" value={formData.w} onChange={e=>setFormData({...formData, w: e.target.value})} className="text-center text-4xl font-black text-white" />
                            <div className="flex gap-2">
                                {['æœ¨å±‘', 'èŒ'].map(s => (
                                    <button key={s} type="button" onClick={()=>setFormData({...formData, sub: s})} className={`flex-1 py-4 rounded-xl text-xs font-black transition-all ${formData.sub === s ? 'bg-[#CA8A04] text-black' : 'bg-zinc-900 text-gray-500'}`}>{s}</button>
                                ))}
                            </div>
                            <button type="submit" className="w-full bg-[#CA8A04] text-black font-black py-5 rounded-2xl text-sm uppercase tracking-widest shadow-xl mt-4 active:scale-95 transition-all">å•Ÿå‹•æ•¸æ“šè¨ºæ–·</button>
                        </form>
                    </div>
                </div>
            );

            if (view === 'loading') return <div className="min-h-screen flex flex-col items-center justify-center bg-[#050505]"><div className="w-16 h-16 border-4 border-zinc-900 border-t-[#CA8A04] rounded-full animate-spin mb-8"></div><p className="text-[11px] text-[#CA8A04] font-mono tracking-[0.5em] animate-pulse uppercase text-center">Syncing_Bona_Engine</p></div>;

            return (
                <div className="min-h-screen p-4 md:p-10 flex flex-col items-center text-left relative">
                    <div className="bg-grid"></div>
                    
                    {/* ç¶²é ç‰ˆ UI (è¢å¹•çœ‹å¾—åˆ°) */}
                    <div id="web-view-ui" className="w-full max-w-2xl animate-fade-up">
                        
                        {showModal && (
                            <div className="fixed inset-0 bg-black/95 z-[100] flex items-center justify-center p-6">
                                <div className="w-full max-w-sm bg-[#18181B] border border-[#CA8A04] p-10 rounded-[2.5rem] shadow-2xl text-center space-y-6">
                                    <div className="text-4xl">ğŸ“œ</div>
                                    <h3 className="text-xl font-black text-white uppercase">{BRAND_NAME} å»ºè­°æ›¸ä¸‹è¼‰</h3>
                                    <p className="text-xs text-gray-400 px-4">è¼¸å…¥è¯çµ¡è³‡è¨Šï¼ˆEmail æˆ– Lineï¼‰ï¼Œç³»çµ±å°‡ä¸‹è¼‰é«˜æ¸…å»ºè­°æ›¸ PDFã€‚</p>
                                    <form onSubmit={submitLeadAndPrint} className="space-y-4 flex flex-col">
                                        <input required placeholder="è¼¸å…¥æ‚¨çš„è¯çµ¡è³‡è¨Š" value={contact} onChange={e=>setContact(e.target.value)} className="w-full text-center" />
                                        <button type="submit" disabled={isSending} className="w-full bg-[#CA8A04] text-black font-black py-4 rounded-xl text-xs uppercase tracking-widest shadow-lg active:scale-95">{isSending ? 'è™•ç†ä¸­...' : 'ä¸‹è¼‰ PDF å»ºè­°æ›¸'}</button>
                                        <button type="button" onClick={()=>setShowModal(false)} className="text-[10px] text-gray-600 font-black uppercase py-2">è¿”å›å ±å‘Š</button>
                                    </form>
                                </div>
                            </div>
                        )}

                        <div className="bg-[#18181B] border border-[#CA8A04]/40 rounded-[2.5rem] shadow-2xl overflow-hidden relative">
                            <header className="p-8 border-b border-white/5 flex justify-between items-center bg-black/40">
                                <div className="flex items-center gap-4">
                                    <LogoIcon className="w-14 h-14" />
                                    <div className="text-left font-bold">
                                        <h1 className="text-xl font-black text-white uppercase italic leading-none">{BRAND_NAME}</h1>
                                        <p className="text-[9px] text-gray-500 font-mono tracking-widest uppercase">PGK Formosa Apex Report</p>
                                    </div>
                                </div>
                                <div className="text-right text-xs font-mono font-black text-[#CA8A04]">#{report.id}</div>
                            </header>
                            
                            <nav className="flex bg-black/30 p-2 border-b border-white/5">
                                {[ {id:'summary', l:'æ•¸æ“š'}, {id:'path', l:'å°æ¨™'}, {id:'advice', l:'å»ºè­°'} ].map(t => (
                                    <button key={t.id} onClick={() => setActiveTab(t.id)} className={`flex-1 py-3 text-[10px] font-black uppercase tracking-widest rounded-xl transition-all ${activeTab === t.id ? 'bg-[#CA8A04] text-black shadow-lg' : 'text-gray-500 hover:text-white'}`}>{t.l}</button>
                                ))}
                            </nav>

                            <main className="p-8 md:p-12 min-h-[400px]">
                                {activeTab === 'summary' && (
                                    <div className="space-y-12 animate-fade-up text-left">
                                        <div className="flex justify-between items-end gap-6 text-left">
                                            <div className="text-left"><h2 className="text-[10px] font-black text-[#CA8A04] border-l-4 border-[#CA8A04] pl-3 mb-4 uppercase">Weight Snapshot</h2><div className="text-8xl font-black text-white tracking-tighter inline-block relative">{report.weight}<span className="text-sm text-[#CA8A04] absolute -right-8 bottom-4 font-mono font-bold tracking-tighter">g</span></div></div>
                                            <div className="text-right text-2xl font-black text-white font-mono">{report.days} <span className="text-xs text-[#CA8A04]">Days</span></div>
                                        </div>
                                        <div className="grid grid-cols-2 gap-4">
                                            <div className="bg-black/40 p-6 rounded-2xl border border-white/5 text-left"><div className="text-[9px] text-gray-600 font-black mb-2">é‘‘å®šè©•ç´š</div><div className={`text-sm font-black uppercase text-[#CA8A04]`}>â— {report.status}</div></div>
                                            <div className="bg-black/40 p-6 rounded-2xl border border-white/5 text-left"><div className="text-[9px] text-gray-600 font-black mb-2">ç•¶å‰é£Ÿæ</div><div className="text-sm font-black text-white uppercase">{report.sub}</div></div>
                                        </div>
                                    </div>
                                )}
                                {activeTab === 'path' && (
                                    <div className="space-y-8 animate-fade-up text-left">
                                        <h3 className="text-xs font-black text-white uppercase tracking-widest flex items-center gap-2"><span className="w-2 h-2 bg-[#CA8A04] rounded-full animate-pulse"></span>å°ç£ PGK å·”å³°å°æ¨™</h3>
                                        <div className="h-64 w-full border-l border-b border-zinc-800 relative flex items-end px-4 overflow-hidden bg-black/60 rounded-2xl">
                                            <svg width="100%" height="100%" viewBox="0 0 100 100" preserveAspectRatio="none" className="overflow-visible"><path d="M0,90 Q40,80 80,15" fill="none" stroke="rgba(202, 138, 4, 0.2)" strokeWidth="1" strokeDasharray="3" /><circle cx={(report.days/650)*100} cy={100 - (report.weight/65)*100} r="4" fill="#CA8A04" /><text x={(report.days/650)*100} y={100 - (report.weight/65)*100 - 15} fill="#CA8A04" fontSize="5" textAnchor="middle" fontWeight="black">ç•¶å‰è½é»: {report.weight}g</text></svg>
                                        </div>
                                        <div className="p-6 bg-zinc-900 rounded-2xl border border-white/5 flex justify-between items-center"><span className="text-[10px] text-gray-500 uppercase font-black tracking-widest">å°æ¨™è½‰åŒ–å¸¸æ•¸</span><span className="text-sm font-black text-[#CA8A04]">{EFF_CONSTANT} mm/g</span></div>
                                    </div>
                                )}
                                {activeTab === 'advice' && (
                                    <div className="space-y-8 animate-fade-up text-left">
                                        <div className="bg-white text-black p-8 rounded-[2.5rem] shadow-2xl flex gap-6 items-start">
                                            <div className="w-14 h-14 rounded-xl bg-black flex items-center justify-center text-[#CA8A04] text-2xl shrink-0">ğŸ§ </div>
                                            <div className="space-y-3 flex-1 text-left">
                                                <p className="text-[10px] text-gray-500 font-black uppercase tracking-[0.3em]">AI ç¹è‚²å°å¸«å»ºè­°</p>
                                                <p className="text-sm text-black leading-relaxed font-bold italic">ã€Œ{report.advice}ã€</p>
                                            </div>
                                        </div>
                                        <button onClick={()=>setShowModal(true)} className="w-full bg-[#CA8A04] text-black font-black py-6 rounded-3xl text-xs uppercase tracking-[0.4em] shadow-2xl hover:bg-yellow-500 transition-all text-center">ä¸‹è¼‰å»ºè­°æ›¸ PDF</button>
                                    </div>
                                )}
                            </main>
                            <footer className="p-8 bg-black/80 border-t border-white/5 text-center text-[9px] text-gray-700 tracking-[0.5em] font-black uppercase mb-3">Scientific Value Delivery â€¢ {BRAND_NAME}</footer>
                        </div>
                        
                        <button onClick={()=>setView('input')} className="mt-8 text-[10px] text-gray-800 font-black uppercase tracking-[0.4em] hover:text-[#CA8A04] transition-all no-print mx-auto block">â† è¿”å›é‡æ–°éŒ„å…¥ (RESET)</button>
                    </div>

                    {/* ã€åˆ—å°å°ˆç”¨æ²™ç›’ã€‘ç™½åº•é»‘å­—ï¼Œç¢ºä¿é¡¯å½± */}
                    <div className="print-only-cert cert-border">
                        <div style={{ display: 'flex', justifyContent: 'space-between', borderBottom: '3px solid #CA8A04', paddingBottom: '30px', marginBottom: '40px' }}>
                             <div style={{ display: 'flex', alignItems: 'center', gap: '20px' }}>
                                <div style={{ background: 'black', color: '#CA8A04', width: '70px', height: '70px', display: 'flex', alignItems: 'center', justifyContent: 'center', fontWeight: '900', fontSize: '32px', borderRadius: '12px' }}>B</div>
                                <div>
                                    <h1 style={{ margin: 0, fontSize: '28px', fontWeight: '900' }}>{BRAND_NAME} SYSTEMS</h1>
                                    <p style={{ margin: 0, fontSize: '11px', color: '#666', letterSpacing: '4px', fontWeight: 'bold' }}>PGK FORMOSA APEX OFFICIAL CERTIFICATE</p>
                                </div>
                             </div>
                             <div style={{ textAlign: 'right' }}>
                                <p style={{ margin: 0, fontSize: '10px', color: '#999', fontWeight: 'bold' }}>é‘‘å®šç·¨è™Ÿ ID</p>
                                <p style={{ margin: 0, fontSize: '18px', fontWeight: '900', color: '#CA8A04' }}>#{report?.id}</p>
                             </div>
                        </div>

                        <div style={{ marginBottom: '50px' }}>
                            <h2 style={{ fontSize: '14px', color: '#CA8A04', fontWeight: '900', textTransform: 'uppercase', marginBottom: '20px', borderLeft: '5px solid #CA8A04', paddingLeft: '15px' }}>æ•¸æ“šæ¦‚è¦½ / Summary</h2>
                            <div style={{ display: 'flex', gap: '60px' }}>
                                <div>
                                    <p style={{ margin: 0, fontSize: '10px', color: '#999', fontWeight: 'bold' }}>å¯¦æ¸¬é‡é‡</p>
                                    <p style={{ margin: 0, fontSize: '60px', fontWeight: '900' }}>{report?.weight}<span style={{ fontSize: '20px', color: '#CA8A04', marginLeft: '5px' }}>g</span></p>
                                </div>
                                <div>
                                    <p style={{ margin: 0, fontSize: '10px', color: '#999', fontWeight: 'bold' }}>é‡æ¸¬æ—¥é½¡</p>
                                    <p style={{ margin: 0, fontSize: '60px', fontWeight: '900' }}>{report?.days}<span style={{ fontSize: '18px', color: '#CA8A04', marginLeft: '5px' }}>Days</span></p>
                                </div>
                            </div>
                        </div>

                        <div className="cert-bg-gray" style={{ padding: '40px', borderRadius: '24px', marginBottom: '50px', border: '1px solid #EEE' }}>
                            <div style={{ display: 'flex', gap: '20px', alignItems: 'flex-start' }}>
                                <div style={{ fontSize: '35px' }}>ğŸ§ </div>
                                <div style={{ textAlign: 'left' }}>
                                    <p style={{ margin: '0 0 10px 0', fontSize: '11px', fontWeight: '900', color: '#CA8A04', textTransform: 'uppercase' }}>Bona AI å°ˆå®¶è¨ºæ–·å»ºè­°çµè«–</p>
                                    <p style={{ margin: 0, fontSize: '16px', lineHeight: '1.8', fontWeight: '700', fontStyle: 'italic' }}>ã€Œ{report?.advice}ã€</p>
                                </div>
                            </div>
                        </div>

                        <div style={{ borderTop: '1px solid #EEE', paddingTop: '30px', textAlign: 'center', opacity: '0.6' }}>
                            <p style={{ fontSize: '10px', color: '#999', letterSpacing: '3px', fontWeight: 'bold' }}>
                                æœ¬èªè­‰æ›¸ç”± Bona Beetle Systems AI æ•¸æ“šå¼•æ“è‡ªå‹•åˆ†æç”Ÿæˆ â€¢ Verified Scientific Data
                            </p>
                            <p style={{ fontSize: '9px', color: '#BBB', marginTop: '10px' }}>Â© 2024 Bona Beetle Lab â€¢ è½‰åŒ–å¸¸æ•¸: {EFF_CONSTANT} mm/g</p>
                        </div>
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>